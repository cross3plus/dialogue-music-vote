<!DOCTYPE html>
<html lang="ja">
<head>
Â  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>æ¥½æ›²æŠ•ç¥¨ãƒ•ã‚©ãƒ¼ãƒ </title>
Â  <style>
Â  Â  body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
Â  Â  h1 { font-size: 1.5em; }
    form { display: flex; flex-direction: column; gap: 15px; }
    fieldset { border: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 10px; }
    .form-row { display: grid; grid-template-columns: 120px 1fr; align-items: center; gap: 10px; }
Â  Â  input[type="number"] { width: 60px; padding: 8px; }
Â  Â  input[type="text"], button { padding: 8px; font-size: 1em; }
    .message { padding: 12px; border-radius: 5px; margin-top: 10px; text-align: center; }
Â  Â  .error { color: #d32f2f; background-color: #ffebee; border: 1px solid #d32f2f; }
    .success { color: #2e7d32; background-color: #e8f5e9; border: 1px solid #2e7d32; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }
Â  </style>
</head>
<body>
  Â  <form id="voteForm">
    Â  </form>
  <div id="votedMessage" style="display:none;" class="success">
    ã‚ãªãŸã¯æ—¢ã«æŠ•ç¥¨æ¸ˆã¿ã§ã™ã€‚ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
  </div>
Â  <h1>ğŸµ æ¥½æ›²æŠ•ç¥¨ãƒ•ã‚©ãƒ¼ãƒ </h1>
Â  <p>10ç‚¹ã‚’å¥½ããªæ¥½æ›²ã«è‡ªç”±ã«é…åˆ†ã—ã¦ãã ã•ã„ï¼ˆåˆè¨ˆ10ç‚¹ï¼‰</p>
Â  <form id="voteForm">
    <div class="form-row">
Â  Â    <label for="name">åå‰ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼‰:</label>
      <input type="text" id="name" required>
    </div>

Â  Â  <fieldset id="songs">
      <div class="form-row"><label for="songA">æ›²A:</label> <input type="number" min="0" max="10" value="0" name="æ›²A" id="songA"></div>
      <div class="form-row"><label for="songB">æ›²B:</label> <input type="number" min="0" max="10" value="0" name="æ›²B" id="songB"></div>
      <div class="form-row"><label for="songC">æ›²C:</label> <input type="number" min="0" max="10" value="0" name="æ›²C" id="songC"></div>
      <div class="form-row"><label for="songD">æ›²D:</label> <input type="number" min="0" max="10" value="0" name="æ›²D" id="songD"></div>
Â  Â  </fieldset>

Â  Â  <div id="messageArea"></div>
Â  Â  <button type="submit" id="submitButton">æŠ•ç¥¨ã™ã‚‹</button>
Â  </form>

Â  <script>
Â  Â  const voteForm = document.getElementById("voteForm");
    const submitButton = document.getElementById("submitButton");
    const messageArea = document.getElementById("messageArea");
    const votedMessage = document.getElementById('votedMessage');
    const VOTE_FLAG_KEY = 'æ¥½æ›²æŠ•ç¥¨2025'; // ä»–ã®ã‚µã‚¤ãƒˆã¨è¢«ã‚‰ãªã„ã‚ˆã†ãªã‚­ãƒ¼å

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã€æŠ•ç¥¨æ¸ˆã¿ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
    if (localStorage.getItem(VOTE_FLAG_KEY)) {
      voteForm.style.display = 'none'; // ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤ºã«
      votedMessage.style.display = 'block'; // æŠ•ç¥¨æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    }
    
Â  Â  voteForm.addEventListener("submit", function(e) {
Â  Â  Â  e.preventDefault();

      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸€æ—¦ã‚¯ãƒªã‚¢
      messageArea.textContent = '';
      messageArea.className = 'message';

Â  Â  Â  const name = document.getElementById("name").value.trim();
Â  Â  Â  const inputs = document.querySelectorAll('#songs input[type="number"]');
Â  Â  Â  let total = 0;
Â  Â  Â  const data = { name: name, votes: {} };
Â Â 
Â  Â  Â  inputs.forEach(input => {
Â  Â  Â  Â  const val = Number(input.value);
Â  Â  Â  Â  total += val;
Â  Â  Â  Â  data.votes[input.name] = val;
Â  Â  Â  });
Â Â 
Â  Â  Â  if (total !== 10) {
        messageArea.textContent = `åˆè¨ˆã¯10ç‚¹ã«ã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨: ${total}ç‚¹ï¼‰`;
        messageArea.classList.add('error');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â Â 
      // é€ä¿¡ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦äºŒé‡é€ä¿¡ã‚’é˜²ã
      submitButton.disabled = true;
      submitButton.textContent = 'é€ä¿¡ä¸­...';

Â  Â  Â  // ğŸ”½ ã“ã“ã¯ã‚ãªãŸã® Google Apps Script ã® URL ã®ã¾ã¾ã«ã—ã¦ãã ã•ã„
Â  Â  Â  const scriptURL ="https://script.google.com/macros/s/AKfycbwGscZXCR-q3tsTonQF2cAhagokWeut9MJFygSFtVBZn9wS-37IQtff1Ujvkmx433VybQ/exec";
Â Â 
      // ===== â˜…â˜…â˜… ã“ã“ã‹ã‚‰ãŒä¸»ãªä¿®æ­£ç‚¹ â˜…â˜…â˜… =====
Â  Â  Â  fetch(scriptURL, {
Â  Â  Â  Â  method: 'POST',
        // mode: 'no-cors' ã‚’è¿½åŠ ã—ã¦CORSã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã—ã¾ã™ã€‚
        // ã“ã‚Œã«ã‚ˆã‚ŠGASã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯å—ã‘å–ã‚Œã¾ã›ã‚“ãŒã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ­£å¸¸ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚
        mode: 'no-cors',
Â  Â  Â  Â  headers: { 'Content-Type': 'text/plain;charset=utf-8' },
Â  Â  Â  Â  body: JSON.stringify(data)
Â  Â  Â  })
Â  Â  Â  .then(() => {
        // mode: 'no-cors' ã§ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚Œã°å¸¸ã«ã“ã® .then() ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
        messageArea.textContent = 'æŠ•ç¥¨ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚';
        messageArea.classList.add('success');
        voteForm.reset(); // ãƒ•ã‚©ãƒ¼ãƒ ã®å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆ
        // æŠ•ç¥¨æˆåŠŸã®å°ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜
        localStorage.setItem(VOTE_FLAG_KEY, 'true'); 
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤ºã«ã—ã€æŠ•ç¥¨æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        voteForm.style.display = 'none';
        votedMessage.style.display = 'block';        
Â  Â  Â  })
Â  Â  Â  .catch(error => {
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãŒãªã„ãªã©ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡è‡ªä½“ã«å¤±æ•—ã—ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼å‡¦ç†
        messageArea.textContent = 'é€ä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
        messageArea.classList.add('error');
        console.error('Fetch Error:', error);
Â  Â  Â  })
      .finally(() => {
        // æˆåŠŸãƒ»å¤±æ•—ã«ã‹ã‹ã‚ã‚‰ãšã€ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’å…ƒã«æˆ»ã—ã¾ã™
        submitButton.disabled = false;
        submitButton.textContent = 'æŠ•ç¥¨ã™ã‚‹';
      });
      // ===== â˜…â˜…â˜… ã“ã“ã¾ã§ãŒä¸»ãªä¿®æ­£ç‚¹ â˜…â˜…â˜… =====
Â  Â  });
Â  </script>
</body>
</html>
